<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>D√©tails du projet - Portfolio Nema Elis√©e Kourouma</title>
    <meta name="description" content="D√©tails complets du projet avec technologies utilis√©es, fonctionnalit√©s et liens vers le code source." />
    <meta name="robots" content="index,follow" />
    <link rel="canonical" href="https://elisee-kourouma.fr/project-details.html" />
    
    <!-- Open Graph -->
    <meta property="og:title" content="D√©tails du projet - Portfolio Nema Elis√©e Kourouma" />
    <meta property="og:description" content="D√©tails complets du projet avec technologies utilis√©es, fonctionnalit√©s et liens vers le code source." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://elisee-kourouma.fr/project-details.html" />
    <meta property="og:image" content="https://elisee-kourouma.fr/assets/photo.jpeg" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="D√©tails du projet - Portfolio Nema Elis√©e Kourouma" />
    <meta name="twitter:description" content="D√©tails complets du projet avec technologies utilis√©es." />
    <meta name="twitter:image" content="https://elisee-kourouma.fr/assets/photo.jpeg" />
    
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíº</text></svg>" />
    <link rel="stylesheet" href="assets/css/styles.css" />
  </head>
  <body id="top" class="dark">
    <!-- Skip Link pour accessibilit√© -->
    <a href="#main-content" class="skip-link">Aller au contenu principal</a>
    
    <header class="container">
      <nav class="nav">
        <a class="brand" href="index.html">Mon Portfolio</a>
        <button id="mobile-menu-toggle" class="menu-mobile-toggle" aria-label="Menu" aria-expanded="false">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div class="menu-mobile-overlay" id="mobile-menu-overlay" style="display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important; position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; z-index: -1 !important;"></div>
        <div class="nav-links" id="nav-links">
          <a href="index.html">Accueil</a>
          <a href="about.html">√Ä propos</a>
          <a href="projects.html">Projets</a>
          <a href="contact.html">Contact</a>
          <a href="#" target="_blank" rel="noopener noreferrer" data-cv-link="true">CV</a>
          <a href="admin.html" class="admin-nav-link admin-nav-hidden">
            <span>üîê</span> <span class="admin-text">Admin</span>
          </a>
        </div>
      </nav>
    </header>
    <main class="container" role="main" id="main-content">
      <div style="margin-bottom: 24px;">
        <a href="projects.html" class="btn secondary">‚Üê Retour aux projets</a>
      </div>
      
      <div id="project-details-container">
        <div style="text-align: center; padding: 40px 20px;">
          <p class="muted">Chargement des d√©tails du projet...</p>
        </div>
      </div>
    </main>
    <button id="scroll-top" class="scroll-top" aria-label="Retour en haut" title="Retour en haut">
      ‚Üë
    </button>
    <footer class="container footer">¬© Mon Portfolio ¬∑ <span data-year></span></footer>
    <script src="assets/js/portfolio.js"></script>
    <script>
      const MON_SERVEUR = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:3000/api'
        : 'https://portfolio-backend-elisee.fly.dev/api';
      
      // Load project details
      document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('project-details-container');
        if (!container) return;

        // Get project title from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const projectTitle = urlParams.get('project');

        if (!projectTitle) {
          container.innerHTML = `
            <div class="card" style="text-align: center; padding: 40px 20px;">
              <h2>Projet non trouv√©</h2>
              <p class="muted">Aucun projet sp√©cifi√© dans l'URL.</p>
              <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
            </div>
          `;
          return;
        }

        // Load project from localStorage
        try {
          const portfolioData = localStorage.getItem('portfolioData');
          if (!portfolioData) {
            container.innerHTML = `
              <div class="card" style="text-align: center; padding: 40px 20px;">
                <h2>Donn√©es non disponibles</h2>
                <p class="muted">Les donn√©es du portfolio ne sont pas disponibles.</p>
                <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
              </div>
            `;
            return;
          }

          const data = JSON.parse(portfolioData);
          const projects = data.projects || [];
          const project = projects.find(p => p.title === projectTitle);

          if (!project) {
            container.innerHTML = `
              <div class="card" style="text-align: center; padding: 40px 20px;">
                <h2>Projet non trouv√©</h2>
                <p class="muted">Le projet "${projectTitle}" n'a pas √©t√© trouv√©.</p>
                <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
              </div>
            `;
            return;
          }

          // Check if project is private and user is not admin
          const isAdminLoggedIn = (() => {
            const session = localStorage.getItem('adminSession');
            if (session) {
              try {
                const sessionData = JSON.parse(session);
                const now = new Date().getTime();
                return sessionData.expires && now < sessionData.expires && sessionData.email === 'kouroumaelisee@gmail.com';
              } catch (e) {
                return false;
              }
            }
            return false;
          })();

          if (project.public === false && !isAdminLoggedIn) {
            container.innerHTML = `
              <div class="card" style="text-align: center; padding: 40px 20px;">
                <h2>Projet priv√©</h2>
                <p class="muted">Ce projet est priv√© et n'est accessible qu'aux administrateurs.</p>
                <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
              </div>
            `;
            return;
          }

          // Render project details
          let tagsHTML = '';
          if (project.tags && project.tags.length > 0) {
            tagsHTML = `<div class="tags" style="margin: 16px 0;">${project.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>`;
          }

          let badgeHTML = '';
          if (project.type) {
            badgeHTML = `<div style="display: inline-block; background: var(--couleur-accent); color: #fff; padding: 6px 14px; border-radius: 999px; font-size: 12px; font-weight: 600; margin-bottom: 16px;">${project.type}${project.featured ? ' ‚≠ê' : ''}</div>`;
          }

          let descriptionHTML = '';
          if (project.description) {
            const descLines = project.description.split('\n').filter(line => line.trim());
            descriptionHTML = `<div style="margin: 24px 0;">${descLines.map(line => `<p style="margin-bottom: 12px; line-height: 1.7;">${line}</p>`).join('')}</div>`;
          }

          let featuresHTML = '';
          if (project.features && project.features.length > 0) {
            featuresHTML = `
              <div style="margin: 32px 0;">
                <h3 style="margin-bottom: 16px;">Fonctionnalit√©s</h3>
                <ul style="list-style: none; padding: 0; margin: 0;">
                  ${project.features.map(feature => `
                    <li style="padding: 10px 0; border-bottom: 1px solid var(--couleur-bordure); display: flex; align-items: start; gap: 12px;">
                      <span style="color: var(--couleur-accent); font-size: 18px; line-height: 1.2;">‚úì</span>
                      <span style="flex: 1; line-height: 1.6;">${feature}</span>
                    </li>
                  `).join('')}
                </ul>
              </div>
            `;
          }

          let linksHTML = '';
          const liveUrl = project.liveUrl || project.link || '';
          const demoLink = project.demoLink || project.githubUrl || '';
          const emailSubject = project.emailSubject || '';
          
          if (liveUrl || demoLink || emailSubject) {
            linksHTML = '<div style="margin: 32px 0; padding-top: 24px; border-top: 1px solid var(--couleur-bordure);"><h3 style="margin-bottom: 16px;">Liens</h3><div style="display: flex; gap: 12px; flex-wrap: wrap;">';
            if (liveUrl) {
              linksHTML += `<a class="btn" href="${liveUrl}" target="_blank" rel="noopener noreferrer">üåê Voir l'application</a>`;
            }
            if (demoLink) {
              linksHTML += `<a class="btn secondary" href="${demoLink}" target="_blank" rel="noopener noreferrer">üíª Code source</a>`;
            }
            if (emailSubject) {
              linksHTML += `<a class="btn secondary" href="#" data-project-inquiry="${project.title}" rel="noopener">üìß Plus d'infos</a>`;
            }
            linksHTML += '</div></div>';
          }

          let docHTML = '';
          if (project.docAvailable) {
            docHTML = `
              <div class="card" style="margin-top: 24px;">
                <h3 style="margin-top: 0; display: flex; align-items: center; gap: 8px;">üìÇ Document prot√©g√©</h3>
                <p class="muted" style="margin-bottom: 12px;">Ce projet dispose d'un document prot√©g√©. Renseignez vos coordonn√©es pour recevoir un lien de t√©l√©chargement temporaire par email.</p>
                <form id="doc-request-details-form" style="display: flex; flex-direction: column; gap: 10px;">
                  <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <input type="text" id="doc-details-firstname" placeholder="Pr√©nom" style="flex:1; min-width: 160px; padding: 10px 12px;" required />
                    <input type="text" id="doc-details-lastname" placeholder="Nom" style="flex:1; min-width: 160px; padding: 10px 12px;" />
                  </div>
                  <input type="email" id="doc-details-email" placeholder="Email pour recevoir le lien" style="padding: 10px 12px;" required />
                  <div id="doc-details-status" class="muted" style="min-height: 18px; font-size: 13px;"></div>
                  <div style="display: flex; gap: 8px; justify-content: flex-start; flex-wrap: wrap;">
                    <button type="submit" class="btn">Envoyer le lien</button>
                    <span class="muted" style="font-size: 12px;">Le lien est valable 1 heure.</span>
                  </div>
                </form>
              </div>
            `;
          }

          container.innerHTML = `
            <article class="card" style="max-width: 900px; margin: 0 auto;">
              ${badgeHTML}
              <h1 style="margin: 0 0 16px 0; font-size: 32px; line-height: 1.2;">${project.title || 'Projet sans titre'}</h1>
              ${project.shortDesc ? `<p class="muted" style="font-size: 18px; margin-bottom: 16px;">${project.shortDesc}</p>` : ''}
              ${tagsHTML}
              ${descriptionHTML}
              ${featuresHTML}
              ${linksHTML}
              ${docHTML}
            </article>
          `;

          // Update page title
          document.title = `${project.title} - D√©tails du projet - Portfolio`;

          const docForm = document.getElementById('doc-request-details-form');
          if (docForm) {
            const statusEl = document.getElementById('doc-details-status');
            const firstEl = document.getElementById('doc-details-firstname');
            const lastEl = document.getElementById('doc-details-lastname');
            const emailEl = document.getElementById('doc-details-email');
            const validerEmail = (email) => /\S+@\S+\.\S+/.test(email);
            docForm.addEventListener('submit', async (ev) => {
              ev.preventDefault();
              const email = emailEl?.value.trim() || '';
              if (!email || !validerEmail(email)) {
                if (statusEl) statusEl.textContent = 'Email invalide';
                return;
              }
              if (statusEl) {
                statusEl.textContent = '';
                statusEl.style.color = 'var(--muted)';
              }
              const btn = docForm.querySelector('button[type="submit"]');
              if (btn) {
                btn.disabled = true;
                btn.textContent = 'Envoi...';
              }
              try {
                const reponse = await fetch(`${MON_SERVEUR}/portfolio/projects/${encodeURIComponent(project.title)}/request-doc`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    firstName: firstEl?.value.trim() || '',
                    lastName: lastEl?.value.trim() || '',
                    email
                  })
                });
                const resultat = await reponse.json().catch(() => ({}));
                if (reponse.ok) {
                  if (statusEl) {
                    statusEl.textContent = 'Lien envoy√© par email. Pensez √† v√©rifier vos spams.';
                    statusEl.style.color = 'var(--accent)';
                  }
                } else {
                  const msg = resultat.error || 'Envoi impossible.';
                  if (statusEl) {
                    statusEl.textContent = msg;
                    statusEl.style.color = 'var(--danger, #f87171)';
                  }
                }
              } catch (err) {
                if (statusEl) {
                  statusEl.textContent = 'Erreur r√©seau, r√©essayez.';
                  statusEl.style.color = 'var(--danger, #f87171)';
                }
              } finally {
                if (btn) {
                  btn.disabled = false;
                  btn.textContent = 'Envoyer le lien';
                }
              }
            });
          }
        } catch (e) {
          const estEnDeveloppement = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
          if (estEnDeveloppement) {
            console.error('Erreur lors du chargement des d√©tails du projet:', e);
          }
          container.innerHTML = `
            <div class="card" style="text-align: center; padding: 40px 20px;">
              <h2>Erreur</h2>
              <p class="muted">Une erreur est survenue lors du chargement des d√©tails du projet.</p>
              <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
            </div>
          `;
        }
      });
    </script>
  </body>
</html>
