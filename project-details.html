<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>D√©tails du projet - Portfolio Nema Elis√©e Kourouma</title>
    <meta name="description" content="D√©tails complets du projet avec technologies utilis√©es, fonctionnalit√©s et liens vers le code source." />
    <meta name="robots" content="index,follow" />
    <link rel="canonical" href="https://elisee-kourouma.fr/project-details.html" />
    
    <!-- Open Graph -->
    <meta property="og:title" content="D√©tails du projet - Portfolio Nema Elis√©e Kourouma" />
    <meta property="og:description" content="D√©tails complets du projet avec technologies utilis√©es, fonctionnalit√©s et liens vers le code source." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://elisee-kourouma.fr/project-details.html" />
    <meta property="og:image" content="https://elisee-kourouma.fr/assets/photo.jpeg" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="D√©tails du projet - Portfolio Nema Elis√©e Kourouma" />
    <meta name="twitter:description" content="D√©tails complets du projet avec technologies utilis√©es." />
    <meta name="twitter:image" content="https://elisee-kourouma.fr/assets/photo.jpeg" />
    
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíº</text></svg>" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script>
      (function() {
        try {
          const raw = localStorage.getItem('portfolioData');
          if (!raw) return;
          const data = JSON.parse(raw);
          if (data?.settings?.maintenance?.enabled !== true) return;
          const message = data?.settings?.maintenance?.message || 'Le site est actuellement en maintenance. Nous serons bient√¥t de retour !';

          const style = document.createElement('style');
          style.id = 'maintenance-guard-style-inline';
          style.textContent = 'main,header,footer{display:none!important;}body{overflow:hidden!important;}';
          document.head.appendChild(style);

          const overlay = document.createElement('div');
          overlay.id = 'maintenance-overlay';
          overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.92);display:flex;align-items:center;justify-content:center;z-index:999999;padding:24px;';
          overlay.innerHTML = '<div class="card" style="max-width:520px;width:100%;text-align:center;gap:12px;display:flex;flex-direction:column;align-items:center;"><div style="font-size:32px;">üõ†Ô∏è</div><h2 style="margin:0;">Site en maintenance</h2><p id="maintenance-message-text" class="muted" style="margin:0;">'+ message +'</p></div>';
          const attach = () => {
            if (!document.getElementById('maintenance-overlay')) {
              document.body.prepend(overlay);
            }
          };
          if (document.body) {
            attach();
          } else {
            document.addEventListener('DOMContentLoaded', attach, { once: true });
          }
        } catch (e) {
          console.error('Maintenance guard inline error:', e);
        }
      })();
    </script>
  </head>
  <body id="top" class="dark">
    <!-- Skip Link pour accessibilit√© -->
    <a href="#main-content" class="skip-link">Aller au contenu principal</a>
    
    <header class="container">
      <nav class="nav">
        <a class="brand" href="index.html">Mon Portfolio</a>
        <button id="mobile-menu-toggle" class="menu-mobile-toggle" aria-label="Menu" aria-expanded="false">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div class="menu-mobile-overlay" id="mobile-menu-overlay" style="display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important; position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; z-index: -1 !important;"></div>
        <div class="nav-links" id="nav-links">
          <a href="index.html">Accueil</a>
          <a href="about.html">√Ä propos</a>
          <a href="projects.html">Projets</a>
          <a href="reports.html">Mes rapports</a>
          <a href="contact.html">Contact</a>
          <a href="#" target="_blank" rel="noopener noreferrer" data-cv-link="true">CV</a>
          <a href="admin.html" class="admin-nav-link admin-nav-hidden">
            <span>üîê</span> <span class="admin-text">Admin</span>
          </a>
        </div>
      </nav>
    </header>
    <main class="container" role="main" id="main-content">
      <div class="back-bar">
        <button class="back-button" type="button" onclick="window.history.length > 1 ? window.history.back() : window.location.href='projects.html';">
          ‚Üê Retour
        </button>
      </div>
      
      <div id="project-details-container">
        <div style="text-align: center; padding: 40px 20px;">
          <p class="muted">Chargement des d√©tails du projet...</p>
        </div>
      </div>
    </main>
    <button id="scroll-top" class="scroll-top" aria-label="Retour en haut" title="Retour en haut">
      ‚Üë
    </button>
    <footer class="container footer">¬© Mon Portfolio ¬∑ <span data-year></span></footer>
    <script src="assets/js/portfolio.js"></script>
    <script>
      const MON_SERVEUR = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:3000/api'
        : 'https://portfolio-backend-elisee.fly.dev/api';
      
      // Load project details
      document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('project-details-container');
        if (!container) return;

        // Get project title from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const projectTitle = urlParams.get('project');

        if (!projectTitle) {
          container.innerHTML = `
            <div class="card" style="text-align: center; padding: 40px 20px;">
              <h2>Projet non trouv√©</h2>
              <p class="muted">Aucun projet sp√©cifi√© dans l'URL.</p>
              <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
            </div>
          `;
          return;
        }

        // Load project from localStorage
        try {
          const portfolioData = localStorage.getItem('portfolioData');
          if (!portfolioData) {
            container.innerHTML = `
              <div class="card" style="text-align: center; padding: 40px 20px;">
                <h2>Donn√©es non disponibles</h2>
                <p class="muted">Les donn√©es du portfolio ne sont pas disponibles.</p>
                <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
              </div>
            `;
            return;
          }

          const data = JSON.parse(portfolioData);
          const projects = data.projects || [];
          const project = projects.find(p => p.title === projectTitle);

          if (!project) {
            container.innerHTML = `
              <div class="card" style="text-align: center; padding: 40px 20px;">
                <h2>Projet non trouv√©</h2>
                <p class="muted">Le projet "${projectTitle}" n'a pas √©t√© trouv√©.</p>
                <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
              </div>
            `;
            return;
          }

          // Check if project is private and user is not admin
          const isAdminLoggedIn = (() => {
            const session = localStorage.getItem('adminSession');
            if (session) {
              try {
                const sessionData = JSON.parse(session);
                const now = new Date().getTime();
                return sessionData.expires && now < sessionData.expires && sessionData.email === 'kouroumaelisee@gmail.com';
              } catch (e) {
                return false;
              }
            }
            return false;
          })();

          if (project.public === false && !isAdminLoggedIn) {
            container.innerHTML = `
              <div class="card" style="text-align: center; padding: 40px 20px;">
                <h2>Projet priv√©</h2>
                <p class="muted">Ce projet est priv√© et n'est accessible qu'aux administrateurs.</p>
                <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
              </div>
            `;
            return;
          }

          // Render project details
          let tagsHTML = '';
          if (project.tags && project.tags.length > 0) {
            tagsHTML = `<div class="tags" style="margin: 16px 0;">${project.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>`;
          }

          let badgeHTML = '';
          if (project.type) {
            badgeHTML = `<div style="display: inline-block; background: var(--couleur-accent); color: #fff; padding: 6px 14px; border-radius: 999px; font-size: 12px; font-weight: 600; margin-bottom: 16px;">${project.type}${project.featured ? ' ‚≠ê' : ''}</div>`;
          }

          let descriptionHTML = '';
          if (project.description) {
            const descLines = project.description.split('\n').filter(line => line.trim());
            descriptionHTML = `<div style="margin: 24px 0;">${descLines.map(line => `<p style="margin-bottom: 12px; line-height: 1.7;">${line}</p>`).join('')}</div>`;
          }

          let featuresHTML = '';
          if (project.features && project.features.length > 0) {
            featuresHTML = `
              <div style="margin: 32px 0;">
                <h3 style="margin-bottom: 16px;">Fonctionnalit√©s</h3>
                <ul style="list-style: none; padding: 0; margin: 0;">
                  ${project.features.map(feature => `
                    <li style="padding: 10px 0; border-bottom: 1px solid var(--couleur-bordure); display: flex; align-items: start; gap: 12px;">
                      <span style="color: var(--couleur-accent); font-size: 18px; line-height: 1.2;">‚úì</span>
                      <span style="flex: 1; line-height: 1.6;">${feature}</span>
                    </li>
                  `).join('')}
                </ul>
              </div>
            `;
          }

          let linksHTML = '';
          const liveUrl = project.liveUrl || project.link || '';
          const demoLink = project.demoLink || project.githubUrl || '';
          const emailSubject = project.emailSubject || '';
          
          if (liveUrl || demoLink || emailSubject) {
            linksHTML = '<div style="margin: 32px 0; padding-top: 24px; border-top: 1px solid var(--couleur-bordure);"><h3 style="margin-bottom: 16px;">Liens</h3><div style="display: flex; gap: 12px; flex-wrap: wrap;">';
            if (liveUrl) {
              linksHTML += `<a class="btn" href="${liveUrl}" target="_blank" rel="noopener noreferrer">üåê Voir l'application</a>`;
            }
            if (demoLink) {
              linksHTML += `<a class="btn secondary" href="${demoLink}" target="_blank" rel="noopener noreferrer">üíª Code source</a>`;
            }
            if (emailSubject) {
              linksHTML += `<a class="btn secondary" href="#" data-project-inquiry="${project.title}" rel="noopener">üìß Plus d'infos</a>`;
            }
            linksHTML += '</div></div>';
          }

          let docHTML = '';
          if (project.docAvailable) {
            docHTML = `
              <div class="card" style="margin-top: 24px;">
                <h3 style="margin-top: 0; display: flex; align-items: center; gap: 8px;">üìÇ Document prot√©g√©</h3>
                <p class="muted" style="margin-bottom: 8px;">Demandez d'abord le mot de passe. Une fois re√ßu de l'auteur, saisissez-le pour t√©l√©charger.</p>
                <form id="doc-request-details-form" style="display: flex; flex-direction: column; gap: 10px;">
                  <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <input type="text" id="doc-details-firstname" placeholder="Pr√©nom" style="flex:1; min-width: 160px; padding: 10px 12px;" required />
                    <input type="text" id="doc-details-lastname" placeholder="Nom" style="flex:1; min-width: 160px; padding: 10px 12px;" />
                  </div>
                  <input type="email" id="doc-details-email" placeholder="Email de contact" style="padding: 10px 12px;" required />
                  <select id="doc-details-purpose" style="padding: 10px 12px;">
                    <option value="Voir le document">Objet : voir le document</option>
                    <option value="T√©l√©charger le document">Objet : t√©l√©charger le document</option>
                  </select>
                  <textarea id="doc-details-message" placeholder="Message (motivation, contexte...)" style="padding: 10px 12px; min-height: 90px; resize: vertical;"></textarea>
                  <div id="doc-details-status" class="muted" style="min-height: 18px; font-size: 13px;"></div>
                  <div style="display: flex; gap: 8px; justify-content: flex-start; flex-wrap: wrap;">
                    <button type="submit" class="btn">Envoyer</button>
                    <span class="muted" style="font-size: 12px;">Vous recevrez le mot de passe apr√®s validation.</span>
                  </div>
                </form>

                <div id="doc-details-password-block" style="display:none; margin-top: 12px; padding: 12px; border: 1px solid var(--couleur-bordure); border-radius: 10px;">
                  <p class="muted" style="margin: 0 0 8px 0; font-size: 13px;">D√©j√† un mot de passe ? Saisissez-le pour t√©l√©charger.</p>
                  <div style="display:flex; gap:8px; flex-wrap: wrap;">
                    <input type="password" id="doc-details-password" placeholder="Mot de passe" style="flex:1; min-width: 200px; padding: 10px 12px;" />
                    <button type="button" class="btn" id="doc-details-password-submit">Valider le mot de passe</button>
                  </div>
                  <div id="doc-details-password-status" class="muted" style="min-height: 16px; font-size: 13px; margin-top:6px;"></div>
                </div>

                <button type="button" id="doc-details-password-toggle" class="btn secondary" style="margin-top:10px;">J'ai d√©j√† un mot de passe</button>
              </div>
            `;
          }

          container.innerHTML = `
            <article class="card" style="max-width: 900px; margin: 0 auto;">
              ${badgeHTML}
              <h1 style="margin: 0 0 16px 0; font-size: 32px; line-height: 1.2;">${project.title || 'Projet sans titre'}</h1>
              ${project.shortDesc ? `<p class="muted" style="font-size: 18px; margin-bottom: 16px;">${project.shortDesc}</p>` : ''}
              ${tagsHTML}
              ${descriptionHTML}
              ${featuresHTML}
              ${linksHTML}
              ${docHTML}
            </article>
          `;

          // Update page title
          document.title = `${project.title} - D√©tails du projet - Portfolio`;

          const docForm = document.getElementById('doc-request-details-form');
          if (docForm) {
            const statusEl = document.getElementById('doc-details-status');
            const firstEl = document.getElementById('doc-details-firstname');
            const lastEl = document.getElementById('doc-details-lastname');
            const emailEl = document.getElementById('doc-details-email');
            const purposeEl = document.getElementById('doc-details-purpose');
            const passwordBlock = document.getElementById('doc-details-password-block');
            const passwordInput = document.getElementById('doc-details-password');
            const passwordSubmit = document.getElementById('doc-details-password-submit');
            const passwordStatus = document.getElementById('doc-details-password-status');
            const passwordToggle = document.getElementById('doc-details-password-toggle');
            const messageEl = document.getElementById('doc-details-message');
            const validerEmail = (email) => /\S+@\S+\.\S+/.test(email);
            docForm.addEventListener('submit', async (ev) => {
              ev.preventDefault();
              const email = emailEl?.value.trim() || '';
              if (!email || !validerEmail(email)) {
                if (statusEl) statusEl.textContent = 'Email invalide';
                return;
              }
              if (statusEl) {
                statusEl.textContent = '';
                statusEl.style.color = 'var(--muted)';
              }
              const btn = docForm.querySelector('button[type="submit"]');
              if (btn) {
                btn.disabled = true;
                btn.textContent = 'Envoi...';
              }
              try {
                const reponse = await fetch(`${MON_SERVEUR}/portfolio/projects/${encodeURIComponent(project.title)}/request-doc`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    firstName: firstEl?.value.trim() || '',
                    lastName: lastEl?.value.trim() || '',
                      email,
                      subject: purposeEl?.value || '',
                      message: messageEl?.value.trim() || ''
                  })
                });
                const resultat = await reponse.json().catch(() => ({}));
                if (reponse.ok) {
                  if (statusEl) {
                    statusEl.textContent = 'Demande envoy√©e. Vous recevrez un mot de passe de l‚Äôauteur.';
                    statusEl.style.color = 'var(--accent)';
                  }
                } else {
                  const msg = resultat.error || 'Envoi impossible.';
                  if (statusEl) {
                    statusEl.textContent = msg;
                    statusEl.style.color = 'var(--danger, #f87171)';
                  }
                }
              } catch (err) {
                if (statusEl) {
                  statusEl.textContent = 'Erreur r√©seau, r√©essayez.';
                  statusEl.style.color = 'var(--danger, #f87171)';
                }
              } finally {
                if (btn) {
                  btn.disabled = false;
                  btn.textContent = 'Envoyer';
                }
              }
            });

            if (passwordToggle && passwordBlock) {
              passwordToggle.addEventListener('click', () => {
                passwordBlock.style.display = 'block';
              });
            }

            if (passwordSubmit) {
              passwordSubmit.addEventListener('click', async () => {
                const password = passwordInput?.value.trim() || '';
                if (!password) {
                  if (passwordStatus) {
                    passwordStatus.textContent = 'Mot de passe requis';
                    passwordStatus.style.color = 'var(--danger, #f87171)';
                  }
                  return;
                }
                if (passwordSubmit) {
                  passwordSubmit.disabled = true;
                  passwordSubmit.textContent = 'Validation...';
                }
                if (passwordStatus) passwordStatus.textContent = '';
                try {
                  const reponse = await fetch(`${MON_SERVEUR}/portfolio/projects/${encodeURIComponent(project.title)}/validate-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                  });
                  const resultat = await reponse.json().catch(() => ({}));
                  if (reponse.ok && resultat.downloadLink) {
                    if (passwordStatus) {
                      passwordStatus.textContent = 'Mot de passe valide. T√©l√©chargement en cours...';
                      passwordStatus.style.color = 'var(--accent)';
                    }
                    window.location.href = resultat.downloadLink;
                  } else {
                    const msg = resultat.error || 'Mot de passe invalide.';
                    if (passwordStatus) {
                      passwordStatus.textContent = msg;
                      passwordStatus.style.color = 'var(--danger, #f87171)';
                    }
                  }
                } catch (err) {
                  if (passwordStatus) {
                    passwordStatus.textContent = 'Erreur r√©seau, r√©essayez.';
                    passwordStatus.style.color = 'var(--danger, #f87171)';
                  }
                } finally {
                  if (passwordSubmit) {
                    passwordSubmit.disabled = false;
                    passwordSubmit.textContent = 'Valider le mot de passe';
                  }
                }
              });
            }
          }
        } catch (e) {
          const estEnDeveloppement = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
          if (estEnDeveloppement) {
            console.error('Erreur lors du chargement des d√©tails du projet:', e);
          }
          container.innerHTML = `
            <div class="card" style="text-align: center; padding: 40px 20px;">
              <h2>Erreur</h2>
              <p class="muted">Une erreur est survenue lors du chargement des d√©tails du projet.</p>
              <a href="projects.html" class="btn" style="margin-top: 16px;">Retour aux projets</a>
            </div>
          `;
        }
      });
    </script>
  </body>
</html>
